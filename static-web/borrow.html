<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/nav.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <link rel="stylesheet" href="../stylesheets/detail.css">
    <link rel="stylesheet" href="../stylesheets/status.css">
    <link rel="stylesheet" href="../stylesheets/borrow.css">
    <title>Mượn sách</title>
</head>
<body>
    <div class="container1">
        <div id="nav-placeholder">
            <div class="nav-all">
                <div class="nav">
                    <img class="logo-hcmus" src="../images/hcmus.png" alt="">
                    <div class="search-bar d-none d-lg-flex">
                        <input type="text" id="input-search" placeholder="Nhập vào thanh tìm kiếm">
                        <select name="type" id="select-type">
                            <option value="name">Tên sách</option>
                            <option value="author">Tác giả</option>
                            <option value="publisher">Nhà xuất bản</option>
                        </select>
                        <button id="btn-search">Tìm kiếm</button>
                    </div>
                    <div class="nav-top">
                        <ul>
                            <li onclick="location.href='info';"><i class="fas fa-user"></i><span>Quản lí tài khoản</span></li>
                            <li class="setting" onclick="location.href='bookshelf';"><i class="fas fa-shopping-cart"></i><span>Giỏ sách</span></li>
                            <li><i class="fas fa-sign-out-alt" onclick="location.href='index';"></i><span onclick="location.href='index';">Đăng xuất</span></li>
                        </ul>
                    </div>
                    
                </div>
                <nav class="navbar navbar-expand navbar-light bg-white">
                        <ul class="navbar-nav mr-auto">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">Trang chủ <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                              Dịch vụ
                            </a>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="bookshelf">Mượn sách</a>
                                <a class="dropdown-item" href="bookshelf">Trả sách</a>
                              <a class="dropdown-item" href="#">Đặt mua sách-giáo trình</a>
                            </div>
                          </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Tin tức</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Liên hệ</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">FAQ</a>
                        </li>
                        </ul>    
                </nav>
            </div>           
        </div>
        <div class="main-container">
            <div class="row">
                <div class="col-lg-3 d-none d-lg-block">
                    <div class="side-panel">
                        <ul class="side-table">
                            <li><i class="fas fa-book"></i><p>DỊCH VỤ</p></li>
                            <li><i class="far fa-newspaper"></i><p>TIN TỨC</p> </li>
                            <li><i class="fas fa-phone"></i><p>LIÊN HỆ</p></li>
                            <li><i class="far fa-question-circle"></i><p>FAQS</p></li>
                        </ul>
                        
                    </div>
                    <ul class="new-table">
                        <div class="headline">
                            <b>TIN TỨC</b>
                        </div>
                        <div id="news">
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                            <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        
                        </div>
                        <div class="more">
                            <a href="">Xem tin khác...</a>
                        </div>
                    </ul>
                </div>
                <div class="col-xs-12 col-lg-9" id="main-content">
                    <div class="content row">
                        
                        <div class="detail col-12 col-md-6">
                            <div class="word-detail">
                                <div class="heading" style="text-align:center"><h4 style="color:#08a30d">PHIẾU MƯỢN SÁCH</h4></div>
                            
                                <div class="register-form">
                                        <p>Ngày mượn:</p>
                                        <input type="date" value="2020-05-31" min="2020-01-01" max="2025-12-31" id="start">
                                        <p>Ngày trả:</p>
                                        <input type="date" value="2020-08-31" min="2020-01-01" max="2025-12-31" id="end">
                                        <p>Số lượng:</p>
                                        <input type="number" value=1 id="number">
                                </div>
                                
                                
                            </div>
                            
                            <div class="button-form">
                                <input type="button" id="ok" class="btn-return" value="Mượn sách" onclick="test()">
                                <input type="button" class="btn-cancel" value="Hủy bỏ" onclick="location.href='/bookshelf';">
                            </div>
                            
                        </div>

                    </div>                                        
                </div>
            </div>
        
        <div class="footer">
            <p>227 Nguyễn Văn Cừ, P.4, Q.5, TP.HCM</p>
        </div>
        <div class="chat-box">
            <p>Chat với thủ thư</p><i class="far fa-comment-dots"></i>
        </div>
        </div>
        
        
    </div>
    <script>
        window.onscroll = function() {myFunction()};
        
        var nav = document.getElementsByClassName("nav-all");
        function myFunction() {
            let height=$(document).height();
            
            let sticky = nav[0].offsetTop;
            if (window.pageYOffset > sticky) {
            nav[0].classList.add("sticky");
            } else {
                    nav[0].classList.remove("sticky");
            }
        }
        
    </script>        
<script src="./../functions/search.js"></script> 
<script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    const book_id = urlParams.get('book');
    if (id!=null) 
    {
        //console.log(1);
        fetch(`/api/bookshelf/id/${id}/`,{
                            method:'GET',
                            headers: {
                            'Content-Type': 'application/json'
                            }
                        }).then(data=>data.json())
                        .then(data=>{
                            fetch(`/api/book/id/${data.bookshelf[0].id_book}`,{
                                method:'GET',
                                headers: {
                                'Content-Type': 'application/json'
                                }
                                }).then(data=>data.json())
                                .then(data=>{
                                    let html=`  <div class="img-content col-12 col-md-6">
                                                <img src="../../uploads/${data[0].image_link}" alt="">
                                                <h5>${data[0].name}</h5>
                                                <div class="rating">
                                                    <div class="star-rating">
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star"></span>
                                                    </div>
                                                    <a href="">(Xem 21 đánh giá)</a>
                                                </div>
                                            </div>`;
                                    let content=document.getElementsByClassName("content")[0];
                                    content.innerHTML=html+content.innerHTML;
                                })
                        })
                    }
    else{
        fetch(`/api/book/id/${book_id}`,{
                                method:'GET',
                                headers: {
                                'Content-Type': 'application/json'
                                }
                                }).then(data=>data.json())
                                .then(data=>{
                                    let html=`  <div class="img-content col-12 col-md-6">
                                                <img src="../../uploads/${data[0].image_link}" alt="">
                                                <h5>${data[0].name}</h5>
                                                <div class="rating">
                                                    <div class="star-rating">
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star checked"></span>
                                                        <span class="fa fa-star"></span>
                                                    </div>
                                                    <a href="">(Xem 21 đánh giá)</a>
                                                </div>
                                            </div>`;
                                    let content=document.getElementsByClassName("content")[0];
                                    content.innerHTML=html+content.innerHTML;
                                })
    }
    var confirm=document.getElementById("ok");
    function test(){
        let number=document.getElementById("number").value;
        let start=document.getElementById("start").value;
        let end=document.getElementById("end").value;
        fetch("/api/borrow/add",{
            method:'POST',
                    headers: {
                    'Content-Type': 'application/json'
                    },
                    body:JSON.stringify({
                            "id":`${id}`,
                            "start":`${start}`,
                            "end":`${end}`,
                            "quantity":`${number}`
                        })  
        })
        .then(()=>location.href="/confirm-borrow")
        .catch(err=>console.log(err));
    }
</script>
</body>
</html>