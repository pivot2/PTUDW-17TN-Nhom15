<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
    <link rel="stylesheet" href="../stylesheets/styles.css">
    <link rel="stylesheet" href="../stylesheets/nav.css">
    <link rel="stylesheet" href="../stylesheets/search.css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <title>Tìm kiếm sách</title>
</head>
<body>
    <div class="container1">
        <div id="nav-placeholder">
            
    <div class="nav-all">
        <div class="nav">
            <img class="logo-hcmus" src="../images/hcmus.png" alt="">
            <div class="search-bar d-none d-lg-flex">
                <input type="text" id="input-search" placeholder="Nhập vào thanh tìm kiếm">
                <select name="type" id="select-type">
                    <option value="name">Tên sách</option>
                    <option value="author">Tác giả</option>   
                    <option value="publisher">Nhà xuất bản</option>
                </select>
                <button id="btn-search">Tìm kiếm</button>
            </div>
            <div class="login-form">
                <div class="username bar">
                    <i class="fas fa-user"></i>
                    <input type="text" class="input-username">
                </div>
                <div class="password bar">
                    <i class="fas fa-lock"></i>
                    <input type="text" class="input-password">
                </div>
                <div class="action bar">
                    <a href="signup">Đăng ký</a>
                    <a href="signup">Quên mật khẩu</a>
                    <i class="fas fa-sign-in-alt" onclick="location.href='login';"></i>
                </div>
            </div>
            
        </div>
        <nav class="navbar navbar-expand navbar-light bg-white">
                <ul class="navbar-nav mr-auto">
                <li class="nav-item active">
                    <a class="nav-link" href="#">Trang chủ <span class="sr-only">(current)</span></a>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="navbardrop" data-toggle="dropdown">
                      Dịch vụ
                    </a>
                    <div class="dropdown-menu">
                      <a class="dropdown-item" href="bookshelf">Mượn sách</a>
                      <a class="dropdown-item" href="bookshelf">Trả sách</a>
                      <a class="dropdown-item" href="#">Đặt mua sách-giáo trình</a>
                    </div>
                  </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Tin tức</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">Liên hệ</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#">FAQS</a>
                </li>
                </ul>    
        </nav>
    </div>
    
   

        </div>

        <div class="row">
            <div class="col-lg-3 d-none d-lg-block">
                <div class="side-panel">
                    <ul class="side-table">
                        <li><i class="fas fa-book"></i><p>DỊCH VỤ</p></li>
                        <li><i class="far fa-newspaper"></i><p>TIN TỨC</p> </li>
                        <li><i class="fas fa-phone"></i><p>LIÊN HỆ</p></li>
                        <li><i class="far fa-question-circle"></i><p>FAQS</p></li>
                    </ul>
                    
                </div>
                <ul class="new-table">
                    <div class="headline">
                        <b>TIN TỨC</b>
                    </div>
                    <div id="news">
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                        <li><i class="fas fa-arrow-right"></i>Danh sách sinh viên nhận thẻ thư viện tháng 3</li>
                    
                    </div>
                    <div class="more">
                        <a href="">Xem tin khác...</a>
                    </div>
                </ul>
            </div>

            <div class="col-xs-12 col-lg-9" id="search-header">
                <h4 id="search-result"></h4>
                <br>
                <div class="row" id="result">
                      
                </div>
                
                
                <nav aria-label="Page navigation search result">
                    <ul class="pagination justify-content-center">
                    </ul>
                </nav>

            </div>
        </div>
    </div>

    </div>

    <script>
        window.onscroll = function() {myFunction()};
        var nav = document.getElementsByClassName("nav-all");
        function myFunction() {
            let height=$(document).height();
            if (height>960)
            {
                let sticky = nav[0].offsetTop;
                if (window.pageYOffset > sticky) {
                    nav[0].classList.add("sticky");
                } else {
                    nav[0].classList.remove("sticky");
                }
            }
        }
    
        $('.option').on('click','a',function(){
            $('.option a.active').removeClass('active');
            $(this).addClass('active');
        });
        $('.pagination').on('click','li',function(){
            $('.pagination li.active').removeClass('active');
            $(this).addClass('active');
        });
    </script>
    <script>
        
        let e=document.getElementById("select-type");
        var result=document.getElementById("result");
        let pagination=document.getElementsByClassName("pagination")[0];
        let search_option=e[e.selectedIndex].value;
        const urlParams = new URLSearchParams(window.location.search);
        const search = urlParams.get('search');
        const search_type = urlParams.get('search_type');
        
        //Load trang dau tien
        function loadPageNumber(){
            return fetch(`/api/book?page=&size=&search=${search}&search_type=${search_type}`,{
                            method:'GET',
                            headers: {
                            'Content-Type': 'application/json'
                            }
                            }).then(data=>data.json())
                            .then(data=>{          
                                search_result=document.getElementById("search-result"); 
                                search_result.innerText=`Tìm kiếm được ${data.length} kết quả liên quan tới "${search}"`;             
                                
                                for (let i=1;i<=Math.ceil(data.length/9);i++)
                                {
                                    let page_normal=`<li class="page-item"><a class="page-link" href="#">${i}</a></li>`;
                                    pagination.innerHTML+=page_normal;
                                }
                                let page_number=document.getElementsByClassName("page-item").length;   
                                return page_number; 
                            })
            
            
        }
        function loadPage(i){
            let page_item=document.getElementsByClassName("page-item");
            result.innerHTML="";
            fetch(`/api/book?page=${i}&size=9&search=${search}&search_type=${search_type}`,{
                                method:'GET',
                                headers: {
                                'Content-Type': 'application/json'
                                }
                                }).then(data=>data.json())
                                .then(data=>{
                                    for (j=0;j<data.length;j++)
                                    {
                                        
                                        let html=`<div class="bg-white card ml-sm-0">
                                                <div class="mx-auto">
                                                    <div class="image-fluid">
                                                        <img src="../uploads/${data[j].image_link}" alt="">
                                                    </div>
                                                    <h5 onclick="location.href='detail?id=${data[j].id}';">${data[j].name}</h5>
                                                    <div>${data[j].author}</div>
                                                    <div class="rating">
                                                        <div class="star-rating">
                                                            <span class="fa fa-star checked"></span>
                                                            <span class="fa fa-star checked"></span>
                                                            <span class="fa fa-star checked"></span>
                                                            <span class="fa fa-star"></span>
                                                            <span class="fa fa-star"></span>
                                                        </div>
                                                        <p>(10 nhận xét)</p>
                                                    </div>
                                                </div>
                                            </div>`;
                                        result.innerHTML+=html;
                                        
                                    }
                                    
                                }
                                )
        }

        loadPageNumber().then(page_number=>{
            //Load trang dau tien
            let page_item=document.getElementsByClassName("page-item");
            page_item[0].classList.add("active");
            loadPage(0);            
            //Xu ly load tung trang 
            for (let i=0;i<page_number;i++){
                page_item[i].onclick=()=>loadPage(i);         
            }
        });
  
    </script>
    <script src="./../functions/search.js"></script> 
</body>
</html>